<%- include('layout', { body: `
<h1 style="margin-bottom: 10px;">Dashboard</h1>
<p style="color: var(--text-secondary); margin-bottom: 30px;">Monitor Matiks brand presence across platforms</p>

<div class="stats-grid">
  <div class="stat-card">
    <h3>Total Mentions</h3>
    <div class="value">${stats.mentions.reduce((sum, p) => sum + p.total, 0)}</div>
  </div>
  <div class="stat-card">
    <h3>Total Reviews</h3>
    <div class="value">${stats.reviews.reduce((sum, p) => sum + p.total, 0)}</div>
  </div>
  <div class="stat-card">
    <h3>Last 24h Mentions</h3>
    <div class="value">${stats.last24h.mentions}</div>
  </div>
  <div class="stat-card">
    <h3>Last 24h Reviews</h3>
    <div class="value">${stats.last24h.reviews}</div>
  </div>
</div>

<div class="section">
  <h2 class="section-title">Platform Breakdown - Mentions</h2>
  <table>
    <thead>
      <tr>
        <th>Platform</th>
        <th>Total</th>
        <th>Positive</th>
        <th>Neutral</th>
        <th>Negative</th>
        <th>Avg Sentiment</th>
      </tr>
    </thead>
    <tbody>
      ${stats.mentions.map(p => `
        <tr>
          <td><span class="platform-badge platform-${p.platform}">${p.platform}</span></td>
          <td>${p.total}</td>
          <td class="positive">${p.positive || 0}</td>
          <td class="neutral">${p.neutral || 0}</td>
          <td class="negative">${p.negative || 0}</td>
          <td>${p.avg_sentiment ? p.avg_sentiment.toFixed(3) : 'N/A'}</td>
        </tr>
      `).join('')}
    </tbody>
  </table>
</div>

<div class="section">
  <h2 class="section-title">Platform Breakdown - Reviews</h2>
  <table>
    <thead>
      <tr>
        <th>Store</th>
        <th>Total</th>
        <th>Avg Rating</th>
        <th>Positive (4-5★)</th>
        <th>Negative (1-2★)</th>
      </tr>
    </thead>
    <tbody>
      ${stats.reviews.map(p => `
        <tr>
          <td><span class="platform-badge platform-${p.platform}">${p.platform}</span></td>
          <td>${p.total}</td>
          <td class="rating">${p.avg_rating ? '★ ' + p.avg_rating.toFixed(1) : 'N/A'}</td>
          <td class="positive">${p.positive_reviews || 0}</td>
          <td class="negative">${p.negative_reviews || 0}</td>
        </tr>
      `).join('')}
    </tbody>
  </table>
</div>

<div class="section">
  <h2 class="section-title">Recent Scrape Jobs</h2>
  <table>
    <thead>
      <tr>
        <th>Time</th>
        <th>Platform</th>
        <th>Status</th>
        <th>Found</th>
        <th>New</th>
        <th>Error</th>
      </tr>
    </thead>
    <tbody>
      ${recentLogs.map(log => `
        <tr>
          <td>${new Date(log.started_at).toLocaleString()}</td>
          <td><span class="platform-badge platform-${log.platform}">${log.platform}</span></td>
          <td><span class="log-status-${log.status}">${log.status}</span></td>
          <td>${log.items_found}</td>
          <td>${log.items_new}</td>
          <td style="color: var(--danger);">${log.error || '-'}</td>
        </tr>
      `).join('')}
    </tbody>
  </table>
</div>

<div class="section">
  <h2 class="section-title">Recent Mentions</h2>
  <table>
    <thead>
      <tr>
        <th>Date</th>
        <th>Platform</th>
        <th>Author</th>
        <th>Content</th>
        <th>Sentiment</th>
      </tr>
    </thead>
    <tbody>
      ${recentMentions.map(m => `
        <tr>
          <td>${new Date(m.created_at).toLocaleDateString()}</td>
          <td><span class="platform-badge platform-${m.platform_name}">${m.platform_name}</span></td>
          <td>${m.author || 'Unknown'}</td>
          <td class="content-cell">${(m.content || '').substring(0, 100)}...</td>
          <td><span class="badge badge-${m.sentiment_label === 'positive' ? 'success' : m.sentiment_label === 'negative' ? 'danger' : 'warning'}">${m.sentiment_label || 'N/A'}</span></td>
        </tr>
      `).join('')}
    </tbody>
  </table>
  <p style="margin-top: 15px;"><a href="/mentions">View all mentions →</a></p>
</div>
` }) %>
