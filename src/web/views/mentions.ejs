<%- include('layout', { body: `
<h1 style="margin-bottom: 10px;">Social Media Mentions</h1>
<p style="color: var(--text-secondary); margin-bottom: 20px;">Track brand mentions across Reddit, Twitter, and LinkedIn</p>

<form class="filters" method="GET">
  <div class="filter-group">
    <label>Platform</label>
    <select name="platform">
      <option value="">All Platforms</option>
      <option value="reddit" ${filters.platform === 'reddit' ? 'selected' : ''}>Reddit</option>
      <option value="twitter" ${filters.platform === 'twitter' ? 'selected' : ''}>Twitter</option>
      <option value="linkedin" ${filters.platform === 'linkedin' ? 'selected' : ''}>LinkedIn</option>
    </select>
  </div>
  <div class="filter-group">
    <label>Sentiment</label>
    <select name="sentiment">
      <option value="">All</option>
      <option value="positive" ${filters.sentiment === 'positive' ? 'selected' : ''}>Positive</option>
      <option value="neutral" ${filters.sentiment === 'neutral' ? 'selected' : ''}>Neutral</option>
      <option value="negative" ${filters.sentiment === 'negative' ? 'selected' : ''}>Negative</option>
    </select>
  </div>
  <div class="filter-group">
    <label>Start Date</label>
    <input type="date" name="startDate" value="${filters.startDate || ''}">
  </div>
  <div class="filter-group">
    <label>End Date</label>
    <input type="date" name="endDate" value="${filters.endDate || ''}">
  </div>
  <div class="filter-group">
    <label>Search</label>
    <input type="text" name="search" placeholder="Search content..." value="${filters.search || ''}">
  </div>
  <div class="filter-group" style="justify-content: flex-end;">
    <label>&nbsp;</label>
    <button type="submit">Apply Filters</button>
  </div>
  <div class="filter-group" style="justify-content: flex-end;">
    <label>&nbsp;</label>
    <a href="/api/export/mentions" class="btn-secondary" style="padding: 10px 20px; background: var(--bg-tertiary); border-radius: 6px;">Export CSV</a>
  </div>
</form>

${mentions.length === 0 ? `
<div class="empty-state">
  <h3>No mentions found</h3>
  <p>Run the scrapers to collect data or adjust your filters.</p>
</div>
` : `
<table>
  <thead>
    <tr>
      <th>Date</th>
      <th>Platform</th>
      <th>Author</th>
      <th>Content</th>
      <th>Engagement</th>
      <th>Sentiment</th>
      <th>Link</th>
    </tr>
  </thead>
  <tbody>
    ${mentions.map(m => `
      <tr>
        <td>${new Date(m.created_at).toLocaleDateString()}</td>
        <td><span class="platform-badge platform-${m.platform_name}">${m.platform_name}</span></td>
        <td>
          ${m.author_url ? `<a href="${m.author_url}" target="_blank">${m.author || 'Unknown'}</a>` : (m.author || 'Unknown')}
        </td>
        <td class="content-cell" title="${(m.content || '').replace(/"/g, '&quot;')}">${(m.content || '').substring(0, 150)}...</td>
        <td>
          <span title="Likes">ğŸ‘ ${m.engagement_likes}</span>
          <span title="Comments">ğŸ’¬ ${m.engagement_comments}</span>
          ${m.engagement_shares > 0 ? `<span title="Shares">ğŸ”„ ${m.engagement_shares}</span>` : ''}
        </td>
        <td>
          <span class="badge badge-${m.sentiment_label === 'positive' ? 'success' : m.sentiment_label === 'negative' ? 'danger' : 'warning'}">
            ${m.sentiment_label || 'N/A'}
          </span>
          <small style="color: var(--text-secondary); margin-left: 5px;">${m.sentiment_score ? m.sentiment_score.toFixed(2) : ''}</small>
        </td>
        <td>
          ${m.url ? `<a href="${m.url}" target="_blank">View â†’</a>` : '-'}
        </td>
      </tr>
    `).join('')}
  </tbody>
</table>

<div style="margin-top: 20px; display: flex; gap: 10px;">
  ${filters.offset > 0 ? `<a href="?${new URLSearchParams({...filters, offset: Math.max(0, (filters.offset || 0) - 50).toString()}).toString()}" class="btn-secondary" style="padding: 8px 16px; background: var(--bg-tertiary); border-radius: 6px;">â† Previous</a>` : ''}
  ${mentions.length >= 50 ? `<a href="?${new URLSearchParams({...filters, offset: ((filters.offset || 0) + 50).toString()}).toString()}" class="btn-secondary" style="padding: 8px 16px; background: var(--bg-tertiary); border-radius: 6px;">Next â†’</a>` : ''}
</div>
`}
` }) %>
